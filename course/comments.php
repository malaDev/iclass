<?phpif (!isset($request[1])) error_404();switch($request[1]){	case "new":		add();		break;	case "delete":		remove();		break;	default:		// gets all comments for a specific page		if(is_numeric($request[1]))			get($request[1]);		else			error_404();		break;}function add(){	global $uvanetid;		// No cache headers for AJAX	header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");	header("Cache-Control: no-store, no-cache, must-revalidate");	header("Cache-Control: post-check=0, pre-check=0", false);	header("Pragma: no-cache");		// file added to the comment	if($_FILES['myfile']) include("upload.php");	$file = $file_newname;		// body of the comment	$comment = $_POST["new-comment"];	$comment = htmlspecialchars(stripslashes($comment));	$comment = mysql_real_escape_string($comment);	$comment = make_links($comment);	$comment = embed_youtube($comment);		$result4 = mysql_query("SELECT * FROM users WHERE uvanetid = '$uvanetid'");	$user = mysql_fetch_array($result4);	$user_id = $user['id'];
	$public = (int)(isset($_POST["public"]) && $_POST["public"] == 'on');
		// insert comment into database	$folderid = $_POST["page_id"];	if (!mysql_query("INSERT INTO comments (user_id, folder_id, file, body, latest_update, public) 
	                                VALUES ('$user_id', '$folderid', '$file', '$comment', CURRENT_TIMESTAMP, $public);"))	{
		$error = mysql_error();		echo "<div class='alert alert-error'>Er ging iets fout met het plaatsen van de comment<br>$error</div>";	}		// show all the comments of this episode including the new posted comment	get($folderid);}function remove(){	// No cache headers for AJAX	header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");	header("Cache-Control: no-store, no-cache, must-revalidate");	header("Cache-Control: post-check=0, pre-check=0", false);	header("Pragma: no-cache");		// uvanetid current user	//$uvanetid = $_GET["u"];		// Delete file if file was added to comment	$cid = $_GET["q"];	$result3 = mysql_query("SELECT file FROM comments WHERE id = $cid");	$file = mysql_fetch_array($result3);	$file = $file['file'];	if ($file != "") {		unlink(getcwd() . '/' . UPLOAD_FOLDER . '/' . $file);	}		// delete comment	mysql_query("DELETE FROM comments WHERE id = $cid");		// delete all replies linked to the comment	mysql_query("DELETE FROM replies WHERE comment_id = $cid");		// show all the comments of this episode including the new posted comment	$folderid = $_GET["f"];	get($folderid);}function get($id){	global $uvanetid;	require_once("lib/models/comments.php");		render('course', '_comments_ajax.html', array(		'page_id' => $id,		'page_comments' => Comments::for_page($id, $uvanetid)	));}